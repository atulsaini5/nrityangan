name: Deploy Self-hosted

on:
  push:
    branches: [ main ]

jobs:
  build-and-deploy:
    # This is the key change: it tells GitHub to use your runner
    runs-on: [react]

    steps:
      # 1. Checkout the repository code into the runner's workspace
      - name: Checkout code
        uses: actions/checkout@v4

      # 2. Set up a specific version of Node.js
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '14.16.1'
          cache: 'npm'

      # 3. Install dependencies and build the application
      - name: Install dependencies
        run: npm ci
      - name: Build application
        run: npm run build

      # 4. Deploy by copying files locally
      - name: Deploy to Webroot
        run: |
          echo "Starting deployment to /var/www/nrityangan..."
          # Use rsync to efficiently sync the build directory to the webroot.
          # The --delete flag removes old files from the webroot that are no longer in the build.
          cp -r dist/index.html /var/www/nrityangan/
          rm -rf dist/
          echo "Deployment successful!"
